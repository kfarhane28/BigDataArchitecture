<!DOCTYPE html>
<html lang="en" class="js no-mobile desktop no-ie chrome chrome83 root-section w-1344 gt-240 gt-320 gt-480 gt-640 gt-768 gt-800 gt-1024 gt-1280 lt-1440 lt-1680 lt-1920 no-portrait landscape gradient rgba opacity textshadow multiplebgs boxshadow borderimage borderradius cssreflections csstransforms csstransitions no-touch retina fontface title domloaded" id="tp2_intro_cassandra-page"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="author" content="Karim FARHANE"><title>Introduction to Apache Cassandra</title><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui" name="viewport"><link href="./Introduction to Apache Cassandra_files/reveal.css" rel="stylesheet"><link rel="stylesheet" href="./Introduction to Apache Cassandra_files/simple.css" id="theme"><link rel="stylesheet" href="./Introduction to Apache Cassandra_files/font-awesome.min.css"><link href="./Introduction to Apache Cassandra_files/zenburn.css" rel="stylesheet"><script>document.write( '<link rel="stylesheet" href="reveal/css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );</script><script type="text/javascript" src="./Introduction to Apache Cassandra_files/highlight.js"></script><script type="text/javascript" src="./Introduction to Apache Cassandra_files/zoom.js"></script><script type="text/javascript" src="./Introduction to Apache Cassandra_files/notes.js"></script><link rel="stylesheet" href="./Introduction to Apache Cassandra_files/paper.css" type="text/css" media="print"></head><body style="transition: -webkit-transform 0.8s ease 0s;"><div class="reveal slide center" role="application" data-transition-speed="default" data-background-transition="fade"><div class="slides" style="width: 1024px; height: 768px; left: 50%; top: 50%; bottom: auto; right: auto; transform: translate(-50%, -50%) scale(0.781172);"><section class="title present" data-state="title" style="top: 138.5px; display: block;"><h1>Introduction to Apache Cassandra</h1><p class="author"><small>Karim FARHANE</small></p></section><section id="plan" hidden="" aria-hidden="true" class="future" style="top: 113px; display: block;"><h2>Plan</h2><div class="ulist"><ul><li><p><strong>Motivation</strong></p></li><li><p>Apache Cassandra</p><div class="ulist"><ul><li><p>Partitioning and replication</p></li><li><p>Consistency</p></li></ul></div></li><li><p>Practice: Tune consistency in Apache Cassandra</p></li></ul></div></section>
<section id="motivation" hidden="" aria-hidden="true" class="future" style="top: 3.5px; display: block;"><h2>Motivation</h2><div class="imageblock" style=""><img src="./Introduction to Apache Cassandra_files/diag-756fce3f1a039781e647eaef4b3b6cf4.png" alt="diag 756fce3f1a039781e647eaef4b3b6cf4"></div>
<div class="ulist"><ul><li><p>do I build new features for customers?</p></li><li><p>or just dealing with reading/writting the data?</p></li></ul></div></section>
<section id="what-went-wrong" hidden="" aria-hidden="true" class="future" style="top: 364px; display: none;"><h2>What went wrong?</h2><div class="ulist"><ul><li><p><strong>A single server cannot take the load ⇒</strong> solution / <strong>complexity</strong></p><div class="ulist"><ul><li><p><em>Better database</em></p><div class="ulist"><ul><li><p>easy to add/remove nodes (<strong>scalling</strong>)</p></li><li><p>transparent data distribution (<strong>auto-sharding</strong>)</p></li><li><p>handle failures (<strong>auto-replication</strong>)</p></li></ul></div></li></ul></div></li></ul></div></section>
<section id="plan-2" hidden="" aria-hidden="true" class="future" style="top: 364px; display: none;"><h2>Plan</h2><div class="ulist"><ul><li><p>Motivation</p></li><li><p><strong>Apache Cassandra</strong></p><div class="ulist"><ul><li><p>Partitioning and replication</p></li><li><p>Consistency</p></li></ul></div></li><li><p>Practice: Tune consistency in Apache Cassandra</p></li></ul></div></section>
<section id="apache-cassandra" hidden="" aria-hidden="true" class="future" style="top: 364px; display: none;"><h2>Apache Cassandra</h2><div class="ulist"><ul><li class="fragment" data-fragment-index="0"><p>started @Facebook inspired by <em>BigTable</em> model and <em>Amazon DynamoDB</em></p></li><li class="fragment" data-fragment-index="1"><p>2008 Open Source Project</p></li><li class="fragment" data-fragment-index="2"><p><strong>Datastax</strong>: commercial offering Datastax Enterprise</p><div class="ulist"><ul><li><p>monitoring(OpsCenter) automating repairs backup…​</p></li><li><p>other features: search, analytics, graph, encryption</p></li></ul></div></li><li class="fragment" data-fragment-index="3"><p>2010 Top Level Apache Project</p><div class="ulist"><ul><li><p>Datastax biggest committer</p></li></ul></div></li><li class="fragment" data-fragment-index="4"><p>2016 Datastax/ASF disagreements(<a href="https://www.theregister.co.uk/2016/11/14/datastax_versus_asf_staxeit/">#Staxit</a>)</p></li></ul></div></section>
<section id="apache-cassandra-2" hidden="" aria-hidden="true" class="future" style="top: 364px; display: none;"><h2>Apache Cassandra</h2><div class="quoteblock"><blockquote><strong>Open source, distributed database</strong> designed to handle <em>large amounts of data across many commodity servers</em>, providing <strong>high availability</strong> with <strong>no single point of failure</strong>.
It offers robust support for clusters spanning <strong>multiple datacenters</strong>, with <strong>asynchronous masterless replication</strong> allowing <strong>low latency</strong> operations for all clients.</blockquote></div></section>
<section id="apache-cassandra-3" hidden="" aria-hidden="true" class="future" style="top: 364px; display: none;"><h2>Apache Cassandra</h2><div class="ulist"><ul><li><p>column oriented NoSQL database</p></li><li><p>distributed (data, query)</p></li><li><p>resilient (no SPOF)</p><div class="ulist"><ul><li><p>we can query any node ⇒ coordinator to dispatch and gather the results</p></li></ul></div></li><li><p>reliable and simple scaling</p></li><li><p>online load balancing and cluster growth</p></li></ul></div>
<aside class="notes"><div class="paragraph"><p>In practice, we can contact a list of nodes and the closest available will become coordinator.
Should we speak about retry policies?</p></div></aside></section>
<section id="apache-cassandra-users" hidden="" aria-hidden="true" class="future" style="top: 364px; display: none;"><h2>Apache Cassandra users</h2><div class="imageblock" style="float: center"><img src="./Introduction to Apache Cassandra_files/apache-cassandra-users.png" alt="apache cassandra users" width="60%"></div>
<div class="paragraph"><p>source: <a href="https://codingjam.it/" class="bare">https://codingjam.it/</a></p></div></section>
<section id="cassandra-terminology" hidden="" aria-hidden="true" class="future" style="top: 364px; display: none;"><h2>Cassandra terminology</h2><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:50%"><col style="width:50%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">RDBMS</th><th class="tableblock halign-left valign-top">Cassandra</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Schema (set of tables)</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>Keyspace</em></strong></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Table</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>Table</em></strong>/<em>column family</em></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Row</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Row</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Database server</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>Node</em></strong></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Master/Slave</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong><em>Cluster</em></strong>: <em>a  set of nodes groupped in one or more datacenters (can span physical locations)</em></p></td></tr></tbody></table></section>
<section id="cassandra-ring" hidden="" aria-hidden="true" class="future" style="top: 364px; display: none;"><h2>Cassandra ring</h2><div class="imageblock" style=""><img src="./Introduction to Apache Cassandra_files/ring1.svg" alt="ring1" width="90%"></div></section>
<section id="gossip" hidden="" aria-hidden="true" class="future" style="top: 364px; display: none;"><h2>Gossip</h2><div class="ulist"><ul><li><p>peer-to-peer communication protocol</p><div class="ulist"><ul><li><p>discover and share <strong><em>location</em></strong> and <strong><em>state information</em></strong> about nodes</p></li><li><p>persist gossip info locally to use when a node restarts</p></li></ul></div></li><li><p><strong>seed nodes</strong> ⇒ bootstrapping the gossip process for new nodes joining the cluster</p></li></ul></div></section>
<section id="cassandra-replicas" hidden="" aria-hidden="true" class="future" style="top: 364px; display: none;"><h2>Cassandra replicas</h2><div class="imageblock" style=""><img src="./Introduction to Apache Cassandra_files/replicas.svg" alt="replicas" width="90%"></div></section>
<section id="cassandra-node-failure" hidden="" aria-hidden="true" class="future" style="top: 364px; display: none;"><h2>Cassandra node failure</h2><div class="imageblock" style=""><img src="./Introduction to Apache Cassandra_files/node_failure.svg" alt="node failure" width="90%"></div></section>
<section id="query" hidden="" aria-hidden="true" class="future" style="top: 364px; display: none;"><h2>Query</h2><div class="imageblock" style="float: center"><img src="./Introduction to Apache Cassandra_files/cluster_query.png" alt="cluster query" width="90%"></div></section>
<section id="plan-3" hidden="" aria-hidden="true" class="future" style="top: 364px; display: none;"><h2>Plan</h2><div class="ulist"><ul><li><p>Motivation</p></li><li><p>Apache Cassandra</p><div class="ulist"><ul><li><p><strong>Partitioning and replication</strong></p></li><li><p>Consistency</p></li></ul></div></li><li><p>Practice: Tune consistency in Apache Cassandra</p></li></ul></div></section>
<section id="cassandra-data-model" hidden="" aria-hidden="true" class="future" style="top: 364px; display: none;"><h2>Cassandra data model</h2><div class="ulist"><ul><li><p>Stores data in <strong>tables</strong>/<strong>column families</strong> as rows that have many columns associated to a row key</p></li><li><p><strong><em>Map&lt;RowKey, SortedMap&lt;ColumnKey, ColumnValue&gt;&gt;</em></strong></p></li></ul></div>
<div class="imageblock" style="float: center"><img src="./Introduction to Apache Cassandra_files/columnar-databases.png" alt="columnar databases" width="60%"></div></section>
<section id="data-partitioning" hidden="" aria-hidden="true" class="future" style="top: 364px; display: none;"><h2>Data partitioning</h2><div class="ulist"><ul><li><p>C* = single logical database spread across a cluster of nodes</p></li><li><p><strong><em>How to divide data evenly around its cluster of nodes?</em></strong></p></li></ul></div>
<div class="ulist"><ul><li class="fragment" data-fragment-index="0"><p><strong>Problems</strong>:</p><div class="ulist"><ul><li><p>distribute data <strong>efficiently</strong>, <strong>evenly</strong></p><div class="ulist"><ul><li><p>determining a node on which a specific piece of data should reside on</p></li><li><p>minimise the data movements when nodes join or leave the cluster</p></li></ul></div></li></ul></div></li><li class="fragment" data-fragment-index="1"><p>Algorithm of <strong>Consistent Hashing</strong></p></li></ul></div></section>
<section id="mapping-data-to-nodes" hidden="" aria-hidden="true" class="future" style="top: 364px; display: none;"><h2>Mapping data to nodes</h2><div class="ulist"><ul><li class="fragment" data-fragment-index="0"><p><strong>Problem</strong>: map <strong>k</strong> entries to <strong>n</strong> physical nodes</p></li><li class="fragment" data-fragment-index="1"><p><em>Naive hashing (NodeID = hash(key) % n)</em> ⇒ remap a large number of keys when nodes join/leave the cluster</p></li><li class="fragment" data-fragment-index="2"><p><strong><em>Consistent hashing</em></strong>: only k/n keys need to be remapped on average</p></li></ul></div></section>
<section id="consistent-hashing" hidden="" aria-hidden="true" class="future" style="top: 364px; display: none;"><h2>Consistent Hashing</h2><div class="ulist"><ul><li><p><strong>Idea</strong> :</p><div class="ulist"><ul><li><p>use a part of the data as a partition key</p></li><li><p>compute a hash value for each</p></li><li><p>The range of values from a consistent hashing algorithm is a fixed circular space which can be visualised as a ring.</p></li></ul></div></li></ul></div></section>
<section id="partitioner" hidden="" aria-hidden="true" class="future" style="top: 364px; display: none;"><h2>Partitioner</h2><div class="ulist"><ul><li><p><strong>hash function</strong> that derives a token from the primary key of a row</p></li><li><p>determines which node will receive the <strong><em>first replica</em></strong></p></li><li><p>RandomPartitioner, <strong>Murmur3Partitioner</strong>, ByteOrdered</p></li></ul></div></section>
<section id="murmur3partitionner" hidden="" aria-hidden="true" class="future" style="top: 364px; display: none;"><h2>Murmur3Partitionner</h2><div class="imageblock" style="float: center"><img src="./Introduction to Apache Cassandra_files/consistent-hashing1.png" alt="consistent hashing1" width="80%"></div></section>
<section id="consistent-hashing-mapping" hidden="" aria-hidden="true" class="future" style="top: 364px; display: none;"><h2>Consistent Hashing: mapping</h2><div class="imageblock" style="float: center"><img src="./Introduction to Apache Cassandra_files/consistent-hashing2.png" alt="consistent hashing2" width="80%"></div></section>
<section id="consistent-hashing-mapping-2" hidden="" aria-hidden="true" class="future" style="top: 364px; display: none;"><h2>Consistent Hashing: mapping</h2><div class="imageblock" style="float: center"><img src="./Introduction to Apache Cassandra_files/consistent-hashing3.png" alt="consistent hashing3" width="80%"></div></section>
<section id="data-replication" hidden="" aria-hidden="true" class="future" style="top: 364px; display: none;"><h2>Data Replication</h2><div class="ulist"><ul><li><p>Create copies of the data, thus avoiding a single point of failure.</p></li><li><p><strong>Replication Factor (RF)</strong> = # of replica for each data</p><div class="ulist"><ul><li><p>set at the <em>Keyspace</em> level</p></li></ul></div></li></ul></div></section>
<section id="topology-informations-strong-em-snitches-em-strong" hidden="" aria-hidden="true" class="future" style="top: 364px; display: none;"><h2>Topology informations: <strong><em>Snitches</em></strong></h2><div class="ulist"><ul><li><p>Inform the database about the <strong><em>network topology</em></strong></p><div class="ulist"><ul><li><p>so requests are routed efficiently</p></li><li><p>and support replication by groupping nodes (racks/datacenters)</p></li></ul></div></li><li><p><strong><em>SimpleSnitch</em></strong> ⇒ does not recognize datacenter or rack information</p></li><li><p><strong><em>RackInferringSnitch</em></strong> ⇒ infers racks and DC information</p></li><li><p><strong><em>PropertyFileSnitch</em></strong> ⇒ uses pre-configured rack/DC informations</p></li></ul></div></section>
<section id="replication-strategies" hidden="" aria-hidden="true" class="future" style="top: 364px; display: none;"><h2>Replication strategies</h2><div class="ulist"><ul><li><p>use proximity information provided by snitches to determine locality of a copy</p><div class="ulist"><ul><li><p><strong>SimpleStrategy</strong>:</p><div class="ulist"><ul><li><p>use only for a single data center and one rack</p></li><li><p>place the copy to the next available node (clockwise)</p></li></ul></div></li><li><p><strong>NetworkTopologyStrategy</strong>: specifies how many replicas you want in each DC</p></li></ul></div></li><li><p>defined at <strong><em>keyspace</em></strong> level</p></li></ul></div></section>
<section id="replication-strategies-2" hidden="" aria-hidden="true" class="future" style="top: 364px; display: none;"><h2>Replication strategies</h2><div class="listingblock"><div class="content"><pre class="highlight"><code class="sql language-sql hljs"><span class="hljs-keyword">CREATE</span> KEYSPACE temperature
<span class="hljs-keyword">WITH</span> <span class="hljs-keyword">replication</span> =
 {<span class="hljs-string">'class'</span>: <span class="hljs-string">'SimpleTopologyStrategy'</span>, <span class="hljs-string">'replication_factor'</span>:<span class="hljs-string">'2'</span>};</code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="sql language-sql hljs"><span class="hljs-keyword">CREATE</span> KEYSPACE lesfurets
<span class="hljs-keyword">WITH</span> <span class="hljs-keyword">replication</span> =
{<span class="hljs-string">'class'</span>: <span class="hljs-string">'NetworkTopologyStrategy'</span>, <span class="hljs-string">'RBX'</span>: <span class="hljs-number">2</span>,<span class="hljs-string">'GRV'</span>:<span class="hljs-number">2</span>,<span class="hljs-string">'LF'</span>:<span class="hljs-number">1</span>};</code></pre></div></div></section>
<section id="simplereplicationstrategy" hidden="" aria-hidden="true" class="future" style="top: 364px; display: none;"><h2>SimpleReplicationStrategy</h2><div class="imageblock" style="float: center"><img src="./Introduction to Apache Cassandra_files/consistent-hashing-adding-nodes.png" alt="consistent hashing adding nodes" width="50%"></div></section>
<section id="networktopologystrategy" hidden="" aria-hidden="true" class="future" style="top: 364px; display: none;"><h2>NetworkTopologyStrategy</h2><div class="listingblock"><div class="content"><pre class="highlight"><code class="bash language-bash hljs">CREATE KEYSPACE lesfurets
WITH replication =
{<span class="hljs-string">'class'</span>: <span class="hljs-string">'NetworkTopologyStrategy'</span>, <span class="hljs-string">'RBX'</span>: 2,<span class="hljs-string">'GRV'</span>:2,<span class="hljs-string">'LF'</span>:1};</code></pre></div></div>
<div class="imageblock" style="float: center"><img src="./Introduction to Apache Cassandra_files/cluster-sauron.png" alt="cluster sauron" width="100%"></div></section>
<section id="token-allocation" hidden="" aria-hidden="true" class="future" style="top: 364px; display: none;"><h2>Token allocation</h2><div class="ulist"><ul><li><p>static allocation (initial-token="-29334…​" dans cassandra.yaml)</p><div class="ulist"><ul><li><p>need to be modified at each topology change</p></li></ul></div></li><li><p>VNODES ( num_tokens )</p><div class="ulist"><ul><li><p>random slot allocation (&lt; 3.0)</p></li><li><p><a href="https://www.datastax.com/dev/blog/token-allocation-algorithm">smart (3.0+) </a></p></li></ul></div></li></ul></div></section>
<section id="virtual-nodes-vnodes" hidden="" aria-hidden="true" class="future" style="top: 364px; display: none;"><h2>Virtual nodes (VNodes)</h2><div class="imageblock" style="float: center"><img src="./Introduction to Apache Cassandra_files/replication_with_vnodes.png" alt="replication with vnodes" width="60%"></div></section>
<section id="vnodes-remapping-keys" hidden="" aria-hidden="true" class="future" style="top: 364px; display: none;"><h2>VNodes: remapping keys</h2><div class="imageblock" style="float: center"><img src="./Introduction to Apache Cassandra_files/restore_with_vnodes.png" alt="restore with vnodes" width="80%"></div></section>
<section id="vnodes-heteregenous-clusters" hidden="" aria-hidden="true" class="future" style="top: 364px; display: none;"><h2>VNodes: heteregenous clusters</h2><div class="imageblock" style="float: center"><img src="./Introduction to Apache Cassandra_files/vnodes_heterogenuos_cluster.png" alt="vnodes heterogenuos cluster" width="80%"></div></section>
<section id="plan-4" hidden="" aria-hidden="true" class="future" style="top: 364px; display: none;"><h2>Plan</h2><div class="ulist"><ul><li><p>Motivation</p></li><li><p>Apache Cassandra</p><div class="ulist"><ul><li><p>Partitioning and replication</p></li><li><p><strong>Consistency</strong></p></li></ul></div></li><li><p>Practice: Tune consistency in Apache Cassandra</p></li></ul></div></section>
<section id="properties-of-distributed-systems" hidden="" aria-hidden="true" class="future" style="top: 364px; display: none;"><h2>Properties of distributed systems</h2><div class="ulist"><ul><li><p><strong>Consistency</strong>:  read is guaranteed to return the most recent write for a given client.</p></li><li><p><strong>Availability</strong>:  non-failing node will return a reasonable response within a reasonable amount of time (no error or timeout)</p></li><li><p><strong>Partition Tolerance</strong>: the system will continue to function when network partitions occur.</p></li></ul></div></section>
<section id="consistency" hidden="" aria-hidden="true" class="future" style="top: 364px; display: none;"><h2>Consistency</h2><div class="ulist"><ul><li><p><em>a read returns the most <strong>recent</strong> write</em></p></li><li><p><em>eventually consistent</em> : guarantee that the system will evolve in a consistent state</p><div class="ulist"><ul><li><p>provided there are no new updates, all nodes/replicas will eventually return the last updated value (~DNS)</p></li></ul></div></li></ul></div>
<div class="imageblock" style=""><img src="./Introduction to Apache Cassandra_files/diag-54e8c136ef3f7e03bf257b7821645fdd.png" alt="diag 54e8c136ef3f7e03bf257b7821645fdd"></div></section>
<section id="availability" hidden="" aria-hidden="true" class="future" style="top: 364px; display: none;"><h2>Availability</h2><div class="ulist"><ul><li><p><em>a non-failing node will return a reasonable response (no error or timeout)</em></p></li></ul></div>
<div class="imageblock" style=""><img src="./Introduction to Apache Cassandra_files/diag-de642d4891bb0dd77ae35be373556a0c.png" alt="diag de642d4891bb0dd77ae35be373556a0c"></div></section>
<section id="partition-tolerance" hidden="" aria-hidden="true" class="future" style="top: 364px; display: none;"><h2>Partition tolerance</h2><div class="ulist"><ul><li><p><em>ability to <strong>function (return a response, error, timeout)</strong>  when network partitions occur</em></p></li></ul></div>
<div class="imageblock" style=""><img src="./Introduction to Apache Cassandra_files/diag-24ce46a2dc539e9aaf58bf2ac4e27444.png" alt="diag 24ce46a2dc539e9aaf58bf2ac4e27444"></div></section>
<section id="partition-tolerance-2" hidden="" aria-hidden="true" class="future" style="top: 364px; display: none;"><h2>Partition tolerance</h2><div class="ulist"><ul><li><p>network <strong>is</strong> unreliable</p></li><li><p><strong>you can choose</strong> how to handle errors</p><div class="ulist"><ul><li><p>return an old value</p></li><li><p>wait and eventually timeout, or return an error at once</p></li></ul></div></li><li><p>in practice: choice between AP and CP systems</p></li></ul></div></section>
<section id="cap-theorem" hidden="" aria-hidden="true" class="future" style="top: 364px; display: none;"><h2>CAP theorem</h2><div class="imageblock" style="float: center"><img src="./Introduction to Apache Cassandra_files/scalability-cap-theorem1.png" alt="scalability cap theorem1"></div></section>
<section id="cassandra-consistency" hidden="" aria-hidden="true" class="future" style="top: 364px; display: none;"><h2>Cassandra consistency</h2><div class="ulist"><ul><li><p><strong>AP</strong> system</p><div class="ulist"><ul><li><p><em>eventually consistent</em></p><div class="ulist"><ul><li><p>without updates the system will converge to a consistent state due to <em>repairs</em></p></li></ul></div></li><li><p><em>tunable consistency</em> :</p><div class="ulist"><ul><li><p>Users can determine the consistency level by tuning it during <strong>read</strong> and <strong>write</strong> operations.</p></li></ul></div></li></ul></div></li></ul></div></section>
<section id="base" hidden="" aria-hidden="true" class="future" style="top: 364px; display: none;"><h2>BASE</h2><div class="ulist"><ul><li><p>RDBMS: <strong>A</strong>tomic, <strong>C</strong>onsistent, <strong>I</strong>solated, <strong>D</strong>urable</p></li><li><p>Cassandra: <strong>B</strong>asically <strong>A</strong>vailable, <strong>S</strong>oft state, <strong>E</strong>ventually consistent</p></li></ul></div></section>
<section id="consistency-level-cl" hidden="" aria-hidden="true" class="future" style="top: 364px; display: none;"><h2>Consistency Level (CL)</h2><div class="ulist"><ul><li class="fragment" data-fragment-index="0"><p>mandatory <strong>protocol-level</strong> parameter for each query (read/write),</p></li><li class="fragment" data-fragment-index="1"><p>#replicas in a cluster that must acknowledge the <strong>read</strong> / <strong>write</strong></p><div class="ulist"><ul><li><p><strong>write consistency - R</strong>: #replicas on which the write <em>must succeed*</em> before returning an acknowledgment to the client application.</p></li><li><p><strong>read consistency - W</strong>: #replicas that must <em>respond to a read</em> request before returning data to the client application</p></li></ul></div></li><li class="fragment" data-fragment-index="2"><p>default level: <em>ONE</em></p></li><li class="fragment" data-fragment-index="3"><p>most used: <em>ONE</em>, <em>QUORUM</em>, <em>ALL</em>, <em>ANY</em> …​ (<em>LOCAL_ONE</em>, <em>LOCAL_QUORUM</em>…​)</p></li></ul></div></section>
<section id="which-consistency-level" hidden="" aria-hidden="true" class="future" style="top: 364px; display: none;"><h2>Which consistency level ?</h2><div class="imageblock" style="float: center"><img src="./Introduction to Apache Cassandra_files/niveau-coherence.png" alt="niveau coherence" width="100%"></div></section>
<section id="consistency-mechanisms" hidden="" aria-hidden="true" class="future" style="top: 364px; display: none;"><h2>Consistency mechanisms</h2><div class="ulist"><ul><li><p><em>writes</em> ⇒ <strong><em>hinted handoff</em></strong></p></li><li><p><em>reads</em> ⇒ <strong><em>read repairs</em></strong></p></li><li><p><em>maintenance</em> ⇒ <strong><em>anti-entropy repair</em></strong> (<em>nodetool repair</em>)</p></li></ul></div></section>
<section id="hinted-handoff" hidden="" aria-hidden="true" class="future" style="top: 364px; display: none;"><h2>Hinted handoff</h2><div class="ulist"><ul><li><p>ONE/QUORUM vs ANY (any node may ACK even if not a replica)</p></li><li><p>if one/more replica(s) are down ⇒ <strong>hinted handoff</strong></p></li></ul></div>
<div class="imageblock" style="float: center"><img src="./Introduction to Apache Cassandra_files/dml_hinted_handoff.png" alt="dml hinted handoff" width="40%"></div>
<aside class="notes"><div class="ulist"><ul><li><p>record on the local node the write (hinted handoff)</p></li><li><p>if replicas return to the ring in a <strong>hinted_handoff_window</strong> they will get the read</p></li></ul></div></aside></section>
<section id="read-repairs" hidden="" aria-hidden="true" class="future" style="top: 364px; display: none;"><h2>Read repairs</h2><div class="ulist"><ul><li class="fragment" data-fragment-index="0"><p>Goal: <strong>detect and fix inconsistencies during reads</strong></p></li><li class="fragment" data-fragment-index="1"><p><strong>CL</strong> = <em>ONE</em> ⇒ no data is repaired because no comparison takes place (unless <strong>read_repair_chance</strong> &gt;0)</p></li><li class="fragment" data-fragment-index="2"><p><strong>CL</strong> &gt; <em>ONE</em> ⇒ repair participating replica nodes in the foreground before the data is returned to the client.</p><div class="ulist"><ul><li><p>C* sends a digest request to each replica not directly involved in the read</p></li><li><p>Cassandra compares all replicas and writes the most recent version to any replica node that does not have it.</p></li></ul></div></li></ul></div></section>
<section id="read-repairs-one" hidden="" aria-hidden="true" class="future" style="top: 364px; display: none;"><h2>Read repairs ONE</h2><div class="imageblock" style="float: center"><img src="./Introduction to Apache Cassandra_files/query_ONE.svg" alt="query ONE" width="80%"></div></section>
<section id="read-repairs-quorum" hidden="" aria-hidden="true" class="future" style="top: 364px; display: none;"><h2>Read repairs QUORUM</h2><div class="imageblock" style="float: center"><img src="./Introduction to Apache Cassandra_files/query_QUORUM.svg" alt="query QUORUM" width="80%"></div></section>
<section id="read-repairs-quorum-dc" hidden="" aria-hidden="true" class="future" style="top: 364px; display: none;"><h2>Read repairs QUORUM DC</h2><div class="imageblock" style="float: center"><img src="./Introduction to Apache Cassandra_files/query_QUORUM_DC.svg" alt="query QUORUM DC" width="40%"></div></section>
<section id="anti-entropy-repair" hidden="" aria-hidden="true" class="future" style="top: 364px; display: none;"><h2>Anti-entropy repair</h2><div class="ulist"><ul><li><p>for each token range, read and synchronize the rows</p></li><li><p>to insure the consistency this tool must be run regularly !</p></li><li><p>not automatised (only on Datastax…​)</p></li></ul></div></section>
<section id="durability" hidden="" aria-hidden="true" class="future" style="top: 364px; display: none;"><h2>Durability</h2><div class="ulist"><ul><li><p>guarantees that writes, once completed, will survive permanently</p><div class="ulist"><ul><li><p>appending writes to a commitlog first</p><div class="ulist"><ul><li><p>default: flushed to disk every <em>commitlog_sync_period_in_ms</em></p></li><li><p>batch mode ⇒ sync before ACK the write</p></li></ul></div></li></ul></div></li></ul></div></section>
<section id="cassandra-write-path" hidden="" aria-hidden="true" class="future" style="top: 364px; display: none;"><h2>Cassandra write path</h2><div class="imageblock" style="float: center"><img src="./Introduction to Apache Cassandra_files/cassandra-write-path.png" alt="cassandra write path" width="80%"></div></section>
<section id="cassandra-compactions" hidden="" aria-hidden="true" class="future" style="top: 364px; display: none;"><h2>Cassandra compactions</h2><div class="ulist"><ul><li><p>collects all versions of each unique row</p></li><li><p>assembles one complete row (up-to-date)</p></li></ul></div>
<div class="imageblock" style="float: center"><img src="./Introduction to Apache Cassandra_files/cassandra-compactions.png" alt="cassandra compactions" width="40%"></div></section>
<section id="cassandra-read-path-caches" hidden="" aria-hidden="true" class="future" style="top: 364px; display: none;"><h2>Cassandra read path (caches)</h2><div class="imageblock" style="float: center"><img src="./Introduction to Apache Cassandra_files/cassandra-read-caches.png" alt="cassandra read caches" width="80%"></div></section>
<section id="cassandra-read-path-disk" hidden="" aria-hidden="true" class="future" style="top: 364px; display: none;"><h2>Cassandra read path (disk)</h2><div class="imageblock" style="float: center"><img src="./Introduction to Apache Cassandra_files/cassandra-read-path1.png" alt="cassandra read path1" width="80%"></div></section>
<section id="more-info" hidden="" aria-hidden="true" class="future" style="top: 364px; display: none;"><h2>More info</h2><div class="ulist"><ul><li><p><a href="https://docs.datastax.com/en/cassandra/3.0/cassandra/dml/dmlDatabaseInternalsTOC.html">Cassandra database internals documentation</a></p></li></ul></div></section>
<section id="plan-5" hidden="" aria-hidden="true" class="future" style="top: 364px; display: none;"><h2>Plan</h2><div class="ulist"><ul><li><p>Motivation</p></li><li><p>Apache Cassandra</p><div class="ulist"><ul><li><p>Partitioning and replication</p></li><li><p>Consistency</p></li></ul></div></li><li><p><strong>Practice: Tune consistency in Apache Cassandra</strong></p></li></ul></div></section>
<section id="practice-tune-consistency-in-apache-cassandra" hidden="" aria-hidden="true" class="future" style="top: 364px; display: none;"><h2>Practice: Tune consistency in Apache Cassandra</h2><div class="olist arabic"><ol class="arabic"><li><p>create local test clusters</p></li><li><p>explore configuration options and consistency properties</p></li></ol></div></section>
<section id="cassandra-cluster-manager" hidden="" aria-hidden="true" class="future" style="top: 364px; display: none;"><h2>Cassandra cluster manager</h2><div class="ulist"><ul><li><p>create multi-node cassandra clusters on the local machine</p></li><li><p>great for quickly setting up clusters for development and testing</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="bash language-bash hljs"><span class="hljs-variable">$ccm</span> create <span class="hljs-built_in">test</span> -v 2.0.5 -n 3 -s <i class="conum" data-value="1"></i><b>(1)</b>

<span class="hljs-variable">$ccm</span> node1 stop <i class="conum" data-value="2"></i><b>(2)</b>

<span class="hljs-variable">$ccm</span> node1 cqlsh <i class="conum" data-value="3"></i><b>(3)</b></code></pre></div></div></section>
<section id="nodetool" hidden="" aria-hidden="true" class="future" style="top: 364px; display: none;"><h2>Nodetool</h2><div class="ulist"><ul><li><p>a command line interface for managing a cluster</p><div class="ulist"><ul><li><p>explore, debug, performance test</p></li><li><p>maintenance operations, repairs</p></li></ul></div></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="bash language-bash hljs"><span class="hljs-variable">$ccm</span> node1 nodetool status mykeyspace <i class="conum" data-value="1"></i><b>(1)</b>

Datacenter: datacenter1
========================
Status=Up/Down
|/ State=Normal/Leaving/Joining/Moving
--  Address    Load       Tokens  Owns    Host ID                               Rack
UN  127.0.0.1  47.66 KB   1       33.3%   aaa1b7c1-6049-4a08-ad3e-3697a0e30e10  rack1
UN  127.0.0.2  47.67 KB   1       33.3%   1848c369-4306-4874-afdf-5c1e95b8732e  rack1
UN  127.0.0.3  47.67 KB   1       33.3%   49578bf1-728f-438d-b1c1-d8dd644b6f7f  rack1</code></pre></div></div></section>
<section id="cqlsh" hidden="" aria-hidden="true" class="future" style="top: 364px; display: none;"><h2>CQLSh</h2><div class="ulist"><ul><li><p>standard CQL client</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="bash language-bash hljs">[bigdata@bigdata ~]$ ccm node2 cqlsh <i class="conum" data-value="1"></i><b>(1)</b>
Connected to <span class="hljs-built_in">test</span> at 127.0.0.2:9160.
[cqlsh 4.1.1 | Cassandra 2.0.5-SNAPSHOT | CQL spec 3.1.1 | Thrift protocol 19.39.0]
Use HELP <span class="hljs-keyword">for</span> <span class="hljs-built_in">help</span>.
cqlsh&gt; SELECT * FROM system.schema_keyspaces ; <i class="conum" data-value="2"></i><b>(2)</b></code></pre></div></div></section>
<section id="vscode-plugin" hidden="" aria-hidden="true" class="future" style="top: 364px; display: none;"><h2>VSCODE plugin</h2><div class="imageblock" style="float: center"><img src="./Introduction to Apache Cassandra_files/vscode-cassandra-plugin.png" alt="vscode cassandra plugin" width="60%"></div></section>
<section id="datastax-studio" hidden="" aria-hidden="true" class="future" style="top: 364px; display: none;"><h2>Datastax Studio</h2><div class="imageblock" style="float: center"><img src="./Introduction to Apache Cassandra_files/datastax-studio.svg" alt="datastax studio" width="90%"></div></section>
<section id="ressources" hidden="" aria-hidden="true" class="future" style="top: 364px; display: none;"><h2>Ressources:</h2><div class="paragraph"><p><a href="http://docs.datastax.com/en/cassandra/3.0/index.html">Datastax documentation</a></p></div>
<div class="paragraph"><p><a href="https://dzone.com/articles/introduction-apache-cassandras" class="bare">https://dzone.com/articles/introduction-apache-cassandras</a></p></div>
<div class="paragraph"><p><a href="https://highlyscalable.wordpress.com/2012/09/18/distributed-algorithms-in-nosql-databases/" class="bare">https://highlyscalable.wordpress.com/2012/09/18/distributed-algorithms-in-nosql-databases/</a></p></div></section></div><div class="backgrounds"><div class="slide-background title present" data-loaded="true" style="display: block;"></div><div class="slide-background future" data-loaded="true" style="display: block;"></div><div class="slide-background future" data-loaded="true" style="display: block;"></div><div class="slide-background future" style="display: none;"></div><div class="slide-background future" style="display: none;"></div><div class="slide-background future" style="display: none;"></div><div class="slide-background future" style="display: none;"></div><div class="slide-background future" style="display: none;"></div><div class="slide-background future" style="display: none;"></div><div class="slide-background future" style="display: none;"></div><div class="slide-background future" style="display: none;"></div><div class="slide-background future" style="display: none;"></div><div class="slide-background future" style="display: none;"></div><div class="slide-background future" style="display: none;"></div><div class="slide-background future" style="display: none;"></div><div class="slide-background future" style="display: none;"></div><div class="slide-background future" style="display: none;"></div><div class="slide-background future" style="display: none;"></div><div class="slide-background future" style="display: none;"></div><div class="slide-background future" style="display: none;"></div><div class="slide-background future" style="display: none;"></div><div class="slide-background future" style="display: none;"></div><div class="slide-background future" style="display: none;"></div><div class="slide-background future" style="display: none;"></div><div class="slide-background future" style="display: none;"></div><div class="slide-background future" style="display: none;"></div><div class="slide-background future" style="display: none;"></div><div class="slide-background future" style="display: none;"></div><div class="slide-background future" style="display: none;"></div><div class="slide-background future" style="display: none;"></div><div class="slide-background future" style="display: none;"></div><div class="slide-background future" style="display: none;"></div><div class="slide-background future" style="display: none;"></div><div class="slide-background future" style="display: none;"></div><div class="slide-background future" style="display: none;"></div><div class="slide-background future" style="display: none;"></div><div class="slide-background future" style="display: none;"></div><div class="slide-background future" style="display: none;"></div><div class="slide-background future" style="display: none;"></div><div class="slide-background future" style="display: none;"></div><div class="slide-background future" style="display: none;"></div><div class="slide-background future" style="display: none;"></div><div class="slide-background future" style="display: none;"></div><div class="slide-background future" style="display: none;"></div><div class="slide-background future" style="display: none;"></div><div class="slide-background future" style="display: none;"></div><div class="slide-background future" style="display: none;"></div><div class="slide-background future" style="display: none;"></div><div class="slide-background future" style="display: none;"></div><div class="slide-background future" style="display: none;"></div><div class="slide-background future" style="display: none;"></div><div class="slide-background future" style="display: none;"></div><div class="slide-background future" style="display: none;"></div><div class="slide-background future" style="display: none;"></div><div class="slide-background future" style="display: none;"></div><div class="slide-background future" style="display: none;"></div><div class="slide-background future" style="display: none;"></div><div class="slide-background future" style="display: none;"></div><div class="slide-background future" style="display: none;"></div><div class="slide-background future" style="display: none;"></div><div class="slide-background future" style="display: none;"></div><div class="slide-background future" style="display: none;"></div><div class="slide-background future" style="display: none;"></div><div class="slide-background future" style="display: none;"></div><div class="slide-background future" style="display: none;"></div><div class="slide-background future" style="display: none;"></div></div><div class="progress" style="display: block;"><span style="width: 0px;"></span></div><aside class="controls" style="display: block;"><button class="navigate-left" aria-label="previous slide"></button><button class="navigate-right enabled" aria-label="next slide"></button><button class="navigate-up" aria-label="above slide"></button><button class="navigate-down" aria-label="below slide"></button></aside><div class="slide-number" style="display: block;"><span class="slide-number-a">1</span></div><div class="speaker-notes" data-prevent-swipe=""></div><div class="pause-overlay"></div><div id="aria-status-div" aria-live="polite" aria-atomic="true" style="position: absolute; height: 1px; width: 1px; overflow: hidden; clip: rect(1px, 1px, 1px, 1px);">Introduction to Apache CassandraKarim FARHANE, gmail.com</div></div><script src="./Introduction to Apache Cassandra_files/head.min.js"></script><script src="./Introduction to Apache Cassandra_files/reveal.js"></script><script>// See https://github.com/hakimel/reveal.js#configuration for a full list of configuration options
Reveal.initialize({
  // Display controls in the bottom right corner
  controls: true,
  // Display a presentation progress bar
  progress: true,
  // Display the page number of the current slide
  slideNumber: true,
  // Push each slide change to the browser history
  history: true,
  // Enable keyboard shortcuts for navigation
  keyboard: true,
  // Enable the slide overview mode
  overview: true,
  // Vertical centering of slides
  center: true,
  // Enables touch navigation on devices with touch input
  touch: true,
  // Loop the presentation
  loop: false,
  // Change the presentation direction to be RTL
  rtl: false,
  // Turns fragments on and off globally
  fragments: true,
  // Flags if the presentation is running in an embedded mode,
  // i.e. contained within a limited portion of the screen
  embedded: false,
  // Number of milliseconds between automatically proceeding to the
  // next slide, disabled when set to 0, this value can be overwritten
  // by using a data-autoslide attribute on your slides
  autoSlide: 0,
  // Stop auto-sliding after user input
  autoSlideStoppable: true,
  // Enable slide navigation via mouse wheel
  mouseWheel: false,
  // Hides the address bar on mobile devices
  hideAddressBar: true,
  // Opens links in an iframe preview overlay
  previewLinks: false,
  // Theme (e.g., beige, black, league, night, serif, simple, sky, solarized, white)
  // NOTE setting the theme in the config no longer works in reveal.js 3.x
  //theme: Reveal.getQueryHash().theme || 'simple',
  // Transition style (e.g., none, fade, slide, convex, concave, zoom)
  transition: Reveal.getQueryHash().transition || 'slide',
  // Transition speed (e.g., default, fast, slow)
  transitionSpeed: 'default',
  // Transition style for full page slide backgrounds (e.g., none, fade, slide, convex, concave, zoom)
  backgroundTransition: 'fade',
  // Number of slides away from the current that are visible
  viewDistance: 3,
  // Parallax background image (e.g., "'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg'")
  parallaxBackgroundImage: '',
  // Parallax background size in CSS syntax (e.g., "2100px 900px")
  parallaxBackgroundSize: '',

  // The "normal" size of the presentation, aspect ratio will be preserved
  // when the presentation is scaled to fit different resolutions. Can be
  // specified using percentage units.
  width: 1024,
  height: 768,

  // Factor of the display size that should remain empty around the content
  margin: 0.01,

  // Bounds for smallest/largest possible scale to apply to content
  minScale: 0.2,
  maxScale: 5,

  // Optional libraries used to extend on reveal.js
  dependencies: [
      { src: 'reveal/lib/js/classList.js', condition: function() { return !document.body.classList; } },
      { src: 'reveal/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
      { src: 'reveal/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
      { src: 'reveal/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
      { src: 'reveal/plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
      { src: 'reveal/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
  ]
});</script></body></html>
